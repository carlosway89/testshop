gx.compatibility.module("dashboard_controller",["user_configuration_service","datatable"],function(a){"use strict";var t=$(this),e=t.find(".latest-orders-table"),n={collapsed:!1},o=$.extend(!0,{},n,a),r=jse.libs.user_configuration_service,i=$(".js-interval-dropdown"),s=i.parents(".toolbar:first"),d=$(".statistic-widget"),c=$(".statistic-chart"),u=c.find("#dashboard-chart"),l=$(".statistic-chart-dropdown"),g=$(".statistic-tab-dropdown"),f=$(".ui-tabs"),p={},h=function(a){switch(a.orders_status){case"1":return"badge badge-warning";case"2":return"badge badge-primary";case"3":case"7":case"149":case"161":case"163":return"badge badge-success";case"0":case"6":case"99":case"162":case"171":return"badge badge-danger";default:return""}},b=function(a){$(this).parent("tr").find("td:eq(0) a").get(0).click()},v=function(){var a={userId:i.data("userId"),configurationKey:"statisticsInterval"},t=function(t){i.find('option[value="'+t+'"]').prop("selected",!0),s.animate({opacity:1},"slow"),i.on("change",function(){var t=$(this).find("option:selected").val();d.trigger("get:data",t),u.is(":visible")&&u.trigger("get:data",t),r.set({data:$.extend(a,{configurationValue:t})})}),i.trigger("change")};s.animate({opacity:.1},"slow");var e="one_week";r.get({data:a,onSuccess:function(a){a.configurationValue&&(e=a.configurationValue),t(e)},onError:function(){t(e)}})},m=function(){function a(a){l.find('option[value="'+a+'"]').prop("selected",!0);var t=i.find("option:selected").val();l.animate({opacity:1},"slow"),u.is(":visible")&&u.trigger("get:data",t,a),r.set({data:$.extend(e,{configurationValue:a})})}function t(){var t="sales";r.get({data:e,onSuccess:function(e){e.configurationValue&&(t=e.configurationValue),a(t)},onError:function(){a(t)}}),l.off().on("change",function(){var t=$(this).find("option:selected").val();a(t)})}var e={userId:i.data("userId"),configurationKey:"statisticsChartItem"};$('a[href="#chart"]').off().on("click",t)},w=function(){function a(a){g.find('option[value="'+a+'"]').prop("selected",!0).trigger("change")}var t={userId:i.data("userId"),configurationKey:"statisticsTab"};g.on("change",function(){var a=$(this).find("option:selected").val();f.trigger("show:tab",a),r.set({data:$.extend(t,{configurationValue:a})})});var e=1;r.get({data:t,onSuccess:function(t){t.configurationValue&&(e=t.configurationValue),a(e)},onError:function(){a(e)}})},y=function(){var a=$('<i class="fa fa-angle-double-up"></i>');o.collapsed&&(a=$('<i class="fa fa-angle-double-down"></i>'),$(".dashboard-chart").hide()),t.find(".dashboard-toggler").append(a),a.on("click",_)},_=function(a,e){var n={userId:i.data("userId"),configurationKey:"dashboard_chart_collapse",configurationValue:!o.collapsed};o.collapsed=!o.collapsed,r.set({data:n}),o.collapsed?$(".dashboard-chart").slideUp():($(".statistic-tab-dropdown").trigger("change"),$(".dashboard-chart").slideDown()),t.find(".dashboard-toggler i").toggleClass("fa-angle-double-down"),t.find(".dashboard-toggler i").toggleClass("fa-angle-double-up")};return p.init=function(a){v(),m(),w(),y(),jse.libs.datatable.create(e,{processing:!0,dom:"t",ordering:!1,ajax:jse.core.config.get("shopUrl")+"/admin/admin.php?do=Dashboard/GetLatestOrders",language:"de"===jse.core.config.get("languageCode")?jse.libs.datatable.getGermanTranslation():null,order:[[3,"desc"]],columns:[{data:"orders_id",className:"text-right",render:function(a,t,e,n){return'<a href="orders.php?page=1&oID='+a+'&action=edit">'+a+"</a>"}},{data:"customers_name"},{data:"text",className:"text-right"},{data:"date_purchased",render:function(a,t,e,n){var o=Date.parse(a);return o.toString("dd.MM.yyyy HH:mm")}},{data:"payment_method"},{data:"orders_status_name",render:function(a,t,e,n){var o=h(e);return'<span class="badge '+o+'">'+a+"</span>"}}]}),e.on("init.dt",function(){e.DataTable().data().length>0&&e.on("click","tbody tr td",b),t.find('tr:not(":eq(0)")').addClass("cursor-pointer")}),a()},p});