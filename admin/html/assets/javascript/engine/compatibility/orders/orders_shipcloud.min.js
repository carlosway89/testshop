gx.compatibility.module("orders_shipcloud",[jse.core.config.get("shopUrl")+"/admin/html/assets/javascript/engine/libs/action_mapper",jse.core.config.get("shopUrl")+"/admin/html/assets/javascript/engine/libs/button_dropdown"],function(e){"use strict";var t=($(this),window.gx.libs.action_mapper,{}),o=function(){$("#sc_modal_content").removeClass("sc_loading"),"1"==$("#sc_single_container").data("is_configured")?$("#sc_show_labels").show():$("#sc_show_labels").hide(),$("#sc_single_form").on("submit",function(e){e.preventDefault()}),$("#sc_single_form input.create_label").on("click",d),$('#sc_single_form select[name="carrier"]').on("change",function(e){$('#sc_single_form input[type="text"]').trigger("change"),$("#sc_single_form .carrier-specific").not(".carrier-"+$(this).val()).hide("fast"),$("#sc_single_form .carrier-"+$(this).val()).not(":visible").show("fast")}),$("#sc_single_form .price_value").on("change",function(){$("#sc_single_form div.sc_quote").html("")}),$("#sc_package_template").on("change",a),$("#sc_single_form input.template_value").on("change",function(){$("#sc_package_template").val("-1")}),$("#sc_get_quote").button("disable"),$('#sc_single_form input[name="quote_carriers[]"]').on("change",function(){$('#sc_single_form input[name="quote_carriers[]"]:checked').length>0?$("#sc_get_quote").button("enable"):$("#sc_get_quote").button("disable")}),$('#sc_single_form input[name="quote_carriers[]"]:first').trigger("change")},a=function(e){var t,o;t=$(this).closest("form"),o=$("option:selected",$(this)),"-1"!==o.val()&&($('input[name="package[weight]"]',t).val(o.data("weight")),$('input[name="package[height]"]',t).val(o.data("height")),$('input[name="package[width]"]',t).val(o.data("width")),$('input[name="package[length]"]',t).val(o.data("length")))},s=function(e){var t=$(e.target).parents("tr").data("row-id")||$("body").find("#gm_order_id").val();$("#sc_modal_content").empty().addClass("sc_loading");var a=(jse.core.lang.translate("create_label","shipcloud"),[{text:jse.core.lang.translate("close","buttons"),"class":"btn",click:function(){$(this).dialog("close"),$("#sc_get_quote").show()}}]);a.push({text:jse.core.lang.translate("show_existing_labels","shipcloud"),"class":"btn",click:c,id:"sc_show_labels"}),a.push({text:jse.core.lang.translate("get_quotes","shipcloud"),"class":"btn btn-primary",click:r,id:"sc_get_quote"}),$("#shipcloud_modal").dialog({autoOpen:!1,modal:!0,title:jse.core.lang.translate("create_label","shipcloud"),dialogClass:"gx-container",buttons:a,width:1e3,position:{my:"center top",at:"center bottom",of:".main-top-header"}}),$("#shipcloud_modal").dialog("open"),$("#sc_modal_content").load("admin.php?do=Shipcloud/CreateLabelForm&orders_id="+t,o)},n=function(){$(".gx-orders-table tr").not(".dataTableHeadingRow").each(function(){jse.libs.button_dropdown.mapAction($(this),"label","shipcloud",s)}),jse.libs.button_dropdown.mapAction($(".order-footer"),"label","shipcloud",s)},l=function(e){$("#sc_modal_content").load("admin.php?do=Shipcloud/LoadLabelList&orders_id="+e,function(){$("#shipcloud_modal").dialog({title:jse.core.lang.translate("labellist_for","shipcloud")+" "+e}),$("#sc_modal_content").removeClass("sc_loading")})},i=function(){$("#sc_modal_content").load("admin.php?do=Shipcloud/UnconfiguredNote")},c=function(e){var t=$('#sc_single_form input[name="orders_id"]').val();return $("#sc_modal_content").empty().addClass("sc_loading"),l(t),$("#sc_show_labels").hide(),$("#sc_get_quote").hide(),!1},r=function(){var e=$("#sc_single_form"),t="";$("#sc_single_form .sc_quote").html(""),$("#sc_single_form .sc_quote").attr("title",""),$('input[name="quote_carriers[]"]:checked').each(function(){var o=$(this).val();$("input.create_label",$(this).closest("tr"));$('input[name="carrier"]',e).val(o),$("#sc_quote_"+o).html(jse.core.lang.translate("loading","shipcloud")),$.ajax({type:"POST",url:jse.core.config.get("shopUrl")+"/admin/admin.php?do=Shipcloud/GetShipmentQuote",data:e.serialize(),dataType:"json"}).done(function(e){"OK"===e.result?(t=e.shipment_quote,$("#sc_quote_"+o).html(t)):"ERROR"===e.result?($("#sc_quote_"+o).html(jse.core.lang.translate("not_possible","shipcloud")),$("#sc_quote_"+o).attr("title",e.error_message)):"UNCONFIGURED"===e.result&&i()}).fail(function(e){t=jse.core.lang.translate("get_quote_error","shipcloud"),$("#sc_quote_"+o).html(t)})}),$('input[name="carrier"]',e).val("")},d=function(e){var t,o;return $("#sc_show_labels").hide(),$("#sc_get_quote").hide(),t=$(this).attr("name"),$('input[name="carrier"]').val(t),o=$("#sc_single_form").serialize(),$("#sc_modal_content").empty().addClass("sc_loading"),$.ajax({type:"POST",url:jse.core.config.get("shopUrl")+"/admin/admin.php?do=Shipcloud/CreateLabelFormSubmit",data:o,dataType:"json"}).done(function(e){$("#sc_modal_content").removeClass("sc_loading"),"UNCONFIGURED"===e.result?i():"OK"===e.result?l(e.orders_id):e.error_message&&$("#sc_modal_content").html('<div class="sc_error">'+e.error_message+"</div>")}).fail(function(e){alert(jse.core.lang.translate("submit_error","shipcloud"))}),!1},_=function(e){var t=[],o="";$('input[name="gm_multi_status[]"]:checked').each(function(){t.push($(this).val())}),$("#sc_modal_content").empty().addClass("sc_loading");var a=[];a.push({text:jse.core.lang.translate("close","buttons"),"class":"btn",click:function(){$(this).dialog("close"),$("#sc_get_quote").show()}}),a.push({text:jse.core.lang.translate("get_quotes","shipcloud"),"class":"btn btn-primary",click:h,id:"sc_get_quote"}),$("#shipcloud_modal").dialog({autoOpen:!1,modal:!0,title:jse.core.lang.translate("create_labels","shipcloud"),dialogClass:"gx-container",buttons:a,width:1e3,position:{my:"center top",at:"center bottom",of:".main-top-header"}}),$("#shipcloud_modal").dialog("open"),t.forEach(function(e){o+="orders[]="+e+"&"}),$("#sc_modal_content").load("admin.php?do=Shipcloud/CreateMultiLabelForm&"+o,u)},u=function(){$("#shipcloud_modal").dialog({title:jse.core.lang.translate("create_labels","shipcloud")}),$("#sc_modal_content").removeClass("sc_loading"),$("#sc_multi_form").on("submit",function(e){return e.preventDefault(),!1}),$("#sc_create_label").hide(),$("#sc_show_labels").hide(),$("#sc_modal_content input, #sc_modal_content select").on("change",function(){$(".sc_multi_quote").hide()}),$("#sc_package_template").on("change",a),$("input.create_label").on("click",m)},m=function(e){var t,o;return o=$(this).attr("name"),$('#sc_multi_form input[name="carrier"]').val(o),t=$("#sc_multi_form").serialize(),$("#sc_modal_content").empty().addClass("sc_loading"),$.ajax({type:"POST",url:jse.core.config.get("shopUrl")+"/admin/admin.php?do=Shipcloud/CreateMultiLabelFormSubmit",data:t,dataType:"json"}).done(function(e){$("#sc_modal_content").removeClass("sc_loading"),"UNCONFIGURED"===e.result?i():"OK"===e.result?p(e.orders_ids):e.error_message&&$("#sc_modal_content").html('<div class="sc_error">'+e.error_message+"</div>")}).fail(function(e){alert(jse.core.lang.translate("submit_error","shipcloud"))}),!1},p=function(e){$("#sc_modal_content").load(jse.core.config.get("shopUrl")+"/admin/admin.php?do=Shipcloud/LoadMultiLabelList",{"orders_ids[]":e},function(){$("#shipcloud_modal").dialog({title:jse.core.lang.translate("labellist","shipcloud")}),$("#sc_modal_content").removeClass("sc_loading")})},h=function(){var e;return $("div.sc_quote").html(""),e=$("#sc_multi_form").serialize(),$.ajax({type:"POST",url:jse.core.config.get("shopUrl")+"/admin/admin.php?do=Shipcloud/GetMultiShipmentQuote",data:e,dataType:"json"}).done(function(e){if("OK"===e.result){for(var t in e.shipment_quotes)$("#sc_multi_quote_"+e.shipment_quotes[t].orders_id).html(e.shipment_quotes[t].shipment_quote);$("div.sc_multi_quote").show("fast");for(var o in e.carriers_total)$("#sc_quote_"+o).html(e.carriers_total[o])}}).fail(function(e){alert(jse.core.lang.translate("submit_error","shipcloud"))}),!1};return t.init=function(e){$("body").prepend($('<div id="shipcloud_modal" title="'+jse.core.lang.translate("create_label_window_title","shipcloud")+'" style="display: none;"><div id="sc_modal_content"></div></div>'));var t=10,o=setInterval(function(){$(".js-button-dropdown").length&&(clearInterval(o),n()),0===t--&&clearInterval(o)},400);jse.libs.button_dropdown.mapAction($("#orders-table-dropdown"),"create_labels","shipcloud",_),e()},t});