gx.compatibility.module("categories_table_controller",[jse.core.config.get("shopUrl")+"/admin/html/assets/javascript/engine/libs/button_dropdown"],function(t){"use strict";var e=($(this),{}),n=($.extend(!0,{},e,t),{}),i=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return null==e?null:e[1]||0},o=i("pID"),a=i("cID"),c=$("tr[data-id="+o+"]"),r=$("tr[data-id="+a+"]");c.addClass("recentlyUpdated"),r.addClass("recentlyUpdated");var p=function(){var t=$('tr[data-id] input[type="checkbox"]:checked');$(".js-bottom-dropdown button").prop("disabled",!t.length)},d=function(t){var e={cPath:"",url:[u(),"categories.php","?action=multi_action"].join(""),pageToken:$('input[name="page_token"]:first').attr("value")};try{e.cPath=window.location.href.match(/cPath=(.*)/)[1]}catch(n){e.cPath=$("[data-cpath]:first").data().cpath}e.url+="&cPath="+e.cPath;var o=i("search");0!==o&&null!==o&&(e.url+="&search="+o);var a=$('<form name="multi_action_form" method="post" action='+e.url+"></form>");return a.append('<input type="hidden" name="cpath" value='+e.cPath+">"),a.append('<input type="hidden" name="page_token" value='+e.pageToken+">"),a.append('<input type="hidden" name='+t+' value="Action">'),a.appendTo("body"),a},s=function(){$(".gx-categories-table tr").not(".dataTableHeadingRow").each(function(){var t=$(this),e=t.data(),n=t.find(".js-button-dropdown");window.setTimeout(function(){t.find(".single-checkbox").on("click",function(t){t.stopPropagation(),p()})},500),e.isProduct?P(n,e):S(n,e),t.find(".fa-folder-open-o, .fa-pencil").parent().on("click",function(e){e.preventDefault();var n=t.find("td:eq(2) a[href]:first").prop("href");window.open(n,"_self")}),t.find(".fa-trash-o").parent().on("click",function(t){var e=n.find("span:contains("+jse.core.lang.translate("delete","buttons")+")");e.click()})})},u=function(){var t=window.location.origin,e=window.location.pathname,n=e.split("/");n.pop();var i=n.join("/");return t+i+"/"},l=function(t,e,n){var i=h[t],o=function(e){b(t,$(e.target),n)};jse.libs.button_dropdown.mapAction(e,t,i,o)},f=function(t,e,n){var i=_[t],o=function(e){x(t,$(e.target),n)};jse.libs.button_dropdown.mapAction(e,t,i,o)},h={edit:"buttons","delete":"buttons",BUTTON_MOVE:"admin_buttons",BUTTON_COPY:"admin_buttons",BUTTON_PROPERTIES:"admin_buttons",BUTTON_EDIT_CROSS_SELLING:"categories",GM_BUTTON_ADD_SPECIAL:"gm_general",BUTTON_EDIT_ATTRIBUTES:"admin_buttons"},_={edit:"buttons","delete":"buttons",BUTTON_MOVE:"admin_buttons",BUTTON_COPY:"admin_buttons",BUTTON_GOOGLE_CATEGORIES:"categories"},b=function(t,e,n){switch(t){case"edit":T(n);break;case"delete":k(e);break;case"BUTTON_MOVE":m(e);break;case"BUTTON_COPY":g(e);break;case"BUTTON_PROPERTIES":O(n);break;case"BUTTON_EDIT_CROSS_SELLING":v(n);break;case"GM_BUTTON_ADD_SPECIAL":w(n);break;case"BUTTON_EDIT_ATTRIBUTES":E(n);break;default:console.alert("Callback not found")}},T=function(t){var e=[u(),"categories.php","?pID="+t.id,"&cPath="+t.cpath,"&action=new_product"].join("");window.open(e,"_self")},k=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=d("multi_delete");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},m=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=d("multi_move");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},g=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=d("multi_copy");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},O=function(t){var e=[u(),"properties_combis.php","?products_id="+t.id,"&cPath="+t.cpath,"&action=edit_category"].join("");window.open(e,"_self")},v=function(t){var e=[u(),"categories.php","?current_product_id="+t.id,"&cPath="+t.cpath,"&action=edit_crossselling"].join("");window.open(e,"_self")},w=function(t){var e=[u(),"specials.php","?pID="+t.id,"&action=new"].join("");window.open(e,"_self")},E=function(t){var e=$('<form method="post" action='+(u()+"new_attributes.php")+"></form>");e.append('<input type="hidden" name="action" value="edit">'),e.append('<input type="hidden" name="current_product_id" value='+t.id+">"),e.append('<input type="hidden" name="cpath" value='+t.cpath+">"),e.appendTo("body"),e.submit()},x=function(t,e,n){switch(t){case"edit":y(n);break;case"delete":U(e);break;case"BUTTON_MOVE":B(e);break;case"BUTTON_COPY":N(e);break;case"BUTTON_GOOGLE_CATEGORIES":I(n);break;default:console.alert("Callback not found")}},y=function(t){var e=[u(),"categories.php","?cID="+t.id,"&cPath="+t.cpath,"&action=edit_category"].join("");window.open(e,"_self")},U=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=d("multi_delete");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},B=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=d("multi_move");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},N=function(t){$(".gx-categories-table").find('input[type="checkbox"]').prop("checked",!1),t.parents("tr:first").find('td:first input[type="checkbox"]').prop("checked",!0);var e=d("multi_copy");t.parents("tr:first").find('td:first input[type="checkbox"]').clone().appendTo(e),e.submit()},I=function(t){var e=$(".lightbox_google_admin_categories");e.attr("href","google_admin_categories.html?categories_id="+t.id),e.click()},P=function(t,e){l("edit",t,e),l("delete",t,e),l("BUTTON_MOVE",t,e),l("BUTTON_COPY",t,e),jse.libs.button_dropdown.addSeparator(t),l("BUTTON_PROPERTIES",t,e),l("BUTTON_EDIT_CROSS_SELLING",t,e),l("GM_BUTTON_ADD_SPECIAL",t,e),l("BUTTON_EDIT_ATTRIBUTES",t,e)},S=function(t,e){f("edit",t,e),f("delete",t,e),f("BUTTON_MOVE",t,e),f("BUTTON_COPY",t,e),jse.libs.button_dropdown.addSeparator(t),f("BUTTON_GOOGLE_CATEGORIES",t,e)},C=function(t){$(t.target).prop("checked")===!0?($("input.checkbox").parent().addClass("checked"),$("input.checkbox").prop("checked",!0)):($("input.checkbox").parent().removeClass("checked"),$("input.checkbox").prop("checked",!1)),p()};return n.init=function(t){var e=setInterval(function(){$(".js-button-dropdown").length>0&&(clearInterval(e),s(),p())},200);p(),$("#gm_check").on("click",C),t()},n});