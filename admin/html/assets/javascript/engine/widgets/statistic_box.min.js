gx.widgets.module("statistic_box",["loading_spinner"],function(t){"use strict";var e=$(this),a=$(".js-interval-dropdown"),n={item:"online",icon:"fa-dashboard",color:"gray"},s=$.extend(!0,{},n,t),r={},o=new Date,l=o.getDate(),d=o.getMonth()+1,i=o.getFullYear(),p=new Date(o.getFullYear(),o.getMonth(),o.getDate()-7),_=p.getDate(),g=p.getMonth()+1,c=p.getFullYear(),h=new Date(o.getFullYear(),o.getMonth(),o.getDate()-14),m=h.getDate(),T=h.getMonth()+1,w=h.getFullYear(),D=new Date(o.getFullYear(),o.getMonth()-1,o.getDate()),x=D.getDate(),u=D.getMonth()+1,S=D.getFullYear(),f=new Date(o.getFullYear(),o.getMonth()-3,o.getDate()),Y=f.getDate(),M=f.getMonth()+1,C=f.getFullYear(),I=new Date(o.getFullYear(),o.getMonth()-6,o.getDate()),b=I.getDate(),A=I.getMonth()+1,y=I.getFullYear(),k=new Date(o.getFullYear()-1,o.getMonth(),o.getDate()),E=k.getDate(),v=k.getMonth()+1,O=k.getFullYear(),R={sales:{apiUrl:"admin.php?do=Dashboard/GetSales",heading:"%timespan%",subtext:jse.core.lang.translate("STATISTICS_SALES","start"),smallText:"("+jse.core.lang.translate("STATISTICS_INTERVAL_TODAY","start")+": %today%)",onClick:function(){switch(a.find("option:selected").val()){case"week":window.open("stats_sales_report.php?report=4&startD="+_+"&startM="+g+"&startY="+c+"&detail=0&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"two_weeks":window.open("stats_sales_report.php?report=3&startD="+m+"&startM="+T+"&startY="+w+"&detail=0&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"month":window.open("stats_sales_report.php?report=3&startD="+x+"&startM="+u+"&startY="+S+"&detail=0&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"three_months":window.open("stats_sales_report.php?report=2&startD="+Y+"&startM="+M+"&startY="+C+"&detail=0&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"six_months":window.open("stats_sales_report.php?report=2&startD="+b+"&startM="+A+"&startY="+y+"&detail=0&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"year":window.open("stats_sales_report.php?report=2&startD="+E+"&startM="+v+"&startY="+O+"&detail=0&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self")}}},online:{apiUrl:"admin.php?do=Dashboard/GetUsersOnline",heading:"%timespan%",subtext:jse.core.lang.translate("STATISTICS_USERS_ONLINE","start"),smallText:"",onClick:function(){window.open("whos_online.php","_self")}},visitors:{apiUrl:"admin.php?do=Dashboard/GetVisitors",heading:"%timespan%",subtext:jse.core.lang.translate("STATISTICS_VISITORS","start"),smallText:"("+jse.core.lang.translate("STATISTICS_INTERVAL_TODAY","start")+": %today%)",onClick:function(){window.open("gm_counter.php","_self")}},newCustomers:{apiUrl:"admin.php?do=Dashboard/GetNewCustomers",heading:"%timespan%",subtext:jse.core.lang.translate("STATISTICS_NEW_CUSTOMERS","start"),smallText:"("+jse.core.lang.translate("STATISTICS_INTERVAL_TODAY","start")+": %today%)",onClick:function(){window.open("customers.php","_self")}},orders:{apiUrl:"admin.php?do=Dashboard/GetOrdersCount",heading:"%timespan%",subtext:jse.core.lang.translate("STATISTICS_ORDERS_COUNT","start"),smallText:"("+jse.core.lang.translate("STATISTICS_INTERVAL_TODAY","start")+": %today%)",onClick:function(){window.open("orders.php","_self")}},conversionRate:{apiUrl:"admin.php?do=Dashboard/GetConversionRate",heading:"%timespan% %",subtext:jse.core.lang.translate("STATISTICS_CONVERSION_RATE","start"),smallText:"("+jse.core.lang.translate("STATISTICS_INTERVAL_TODAY","start")+": %today% %)",onClick:function(){window.open("gm_counter.php","_self")}},avgOrderTotal:{apiUrl:"admin.php?do=Dashboard/GetAverageOrderValue",heading:"%timespan%",subtext:jse.core.lang.translate("STATISTICS_AVERGAGE_ORDER_VALUE","start"),smallText:"("+jse.core.lang.translate("STATISTICS_INTERVAL_TODAY","start")+": %today%)",onClick:function(){switch(a.find("option:selected").val()){case"week":window.open("stats_sales_report.php?report=4&startD="+_+"&startM="+g+"&startY="+c+"&detail=2&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"two_weeks":window.open("stats_sales_report.php?report=3&startD="+m+"&startM="+T+"&startY="+w+"&detail=2&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"month":window.open("stats_sales_report.php?report=3&startD="+x+"&startM="+u+"&startY="+S+"&detail=2&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"three_months":window.open("stats_sales_report.php?report=2&startD="+Y+"&startM="+M+"&startY="+C+"&detail=2&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"six_months":window.open("stats_sales_report.php?report=2&startD="+b+"&startM="+A+"&startY="+y+"&detail=2&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self");break;case"year":window.open("stats_sales_report.php?report=2&startD="+E+"&startM="+v+"&startY="+O+"&detail=2&max=0&payment=0&export=0&sort=4&endD="+l+"&endM="+d+"&endY="+i,"_self")}}}},j={today:"%today%",timespan:"%timespan%"},F=function(t,e){for(var a in j)j.hasOwnProperty(a)&&(t=t.replace(j[a],e[a]));return t},N=function(t){var a=window.gx.libs.loading_spinner.show(e);$.ajax({url:R[s.item].apiUrl+"&interval="+t,type:"GET",dataType:"json"}).done(function(t){var n=e.find(".heading"),r=e.find(".subtext"),o=e.find(".small-text"),l={timespan:t.timespan,today:t.today};window.gx.libs.loading_spinner.hide(a).done(function(){e.find(".icon-container, .text-container").animate({opacity:1},"slow")}),n.text(F(R[s.item].heading,l)),r.text(F(R[s.item].subtext,l)),o.text(F(R[s.item].smallText,l))}).fail(function(t){throw new Error("Failed to load statistic resource")})},U=function(){var t,a,n,r,o,l;a=$("<i>"),a.addClass("fa fa-fw fa-lg").addClass(s.icon),t=$("<div>"),t.addClass("icon-container span4").addClass(s.color).append(a),r=$("<div>"),r.addClass("heading"),o=$("<div>"),o.addClass("subtext"),l=$("<div>"),l.addClass("small-text"),n=$("<div>"),n.addClass("text-container span8").append(r).append(o).append(l),e.on("click",function(t){R[s.item].onClick(t)}),e.addClass("toolbar grid").append(t).append(n),e.on("get:data",function(t,e){e&&N(e)})};return r.init=function(t){U(),t()},r});