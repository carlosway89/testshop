gx.extensions.module("language_switcher",["form"],function(t){"use strict";var e=$(this),i={position:1,initLang:js_options.global.language_id},n=$.extend(!0,{},i,t),a={},r=[],c=null,o=[],l=function(t,i){var a={},c=jse.core.fallback.getData(e);return $.each(r,function(e,r){var o=r.match(/\[([^\]]+)\]/gi),l=r.split("[")[0],s=l,f=l,u=!1;o&&($.each(o,function(e,a){n.position!==e?(f+=a,s+=a):(i?f+="["+t+"]":s+="["+t+"]",u=!0)}),u&&void 0!==c[s]&&(a[f]=c[s]))}),a},s=function(t){var i=t.attr("href").slice(1);e.find("textarea").each(function(){var t=$(this),e=t.attr("name"),i=window.CKEDITOR?CKEDITOR.instances[e]:null;i&&t.val(i.getData())}),jse.libs.form.prefillForm(e,l(i,!0),!1)},f=function(t){var i=t.attr("href").slice(1);jse.libs.form.prefillForm(e,l(i,!1),!1),e.find("textarea").each(function(){var t=$(this),e=t.attr("name"),i=t.text(),n=window.CKEDITOR?CKEDITOR.instances[e]:null;n&&n.setData(i)})},u=function(){window.CKEDITOR&&e.find("textarea").each(function(){var t=$(this).attr("name");CKEDITOR.instances[t]&&-1===$.inArray(t,o)&&(o.push(t),CKEDITOR.instances[t].on("blur",function(){s(c.filter(".active"))}))})},v=function(t){t.preventDefault();var e=$(this);if(!e.hasClass("active")){var i=c.filter(".active");c.removeClass("active"),e.addClass("active"),i.length&&s(i),f(e)}},g=function(t){t.preventDefault();var e=c.filter(".active");f(e)},d=function(t,e){if(e&&e.deferred){var i=c.filter(".active").first().attr("href").slice(1);e.deferred.resolve(i)}};return a.init=function(t){c=e.find(".buttonbar a");var i=function(){r=[];var t=e.find("input:not(:button):not(:submit), select, textarea");t.each(function(){var t=$(this),e=jse.libs.form.getFieldType(t),i=$.inArray(e,["text","textarea"])>-1?"blur":"change",n=t.attr("name");r.push(n),t.on(i,function(){s(c.filter(".active"))})}),u()};i(),e.on("widget.initialized",function(t,e){"ckeditor"===e&&u()}),c.on("click",v).filter('[href="#'+n.initLang+'"]').trigger("click"),e.on("widget.initialized",function(t,e){"language_switcher"!==e.widget&&u()}).on("layerClose",function(){s(c.filter(".active"))}).on("language_switcher.update",i).on("language_switcher.updateField",g).on("language_switcher.getLang",d),t()},a});