jse.libs.modal=jse.libs.modal||{},function(e){"use strict";var t=$("body"),a={yes:{name:jse.core.lang.translate("yes","buttons"),type:"success"},no:{name:jse.core.lang.translate("no","buttons"),type:"fail"},abort:{name:jse.core.lang.translate("abort","buttons"),type:"fail"},ok:{name:jse.core.lang.translate("ok","buttons"),type:"success"},close:{name:jse.core.lang.translate("close","buttons"),type:"fail"}},n=function(e,t){var a=e.filter("form").add(e.find("form")),n={},o=[];return a.length&&a.each(function(){var e=$(this);if(t){var a=$.Deferred();o.push(a),e.trigger("validator.validate",{deferred:a})}var l=e.attr("name")||e.attr("id")||"form_"+(new Date).getTime()*Math.random();n[l]=window.jse.lib.form.getData(e)}),$.when.apply(void 0,o).then(function(e){return n},function(e){return n}).promise()},o=function(e,t){n(e).always(function(a){t.reject(a),e.dialog("close").remove()})},l=function(e,t){n(e,!0).done(function(a){t.resolve(a),e.dialog("close").remove()})},r=function(e,t){var a=[],n=null;return e&&$.each(e,function(e,r){n={},n.text=r.name||"BUTTON",n.click=function(){var e=$(this);switch("function"==typeof r.callback&&r.callback.apply(e,[]),r.type){case"fail":o(e,t);break;case"success":l(e,t)}},a.push(n)}),a},i=function(e){var a=[],n=$.Deferred();try{a=$(e.template)}catch(o){jse.core.debug(jse.core.lang.templateNotFound(e.template))}return a.length?n.resolve(a.html()):window.jse.lib.ajax({url:e.template,dataType:"html"}).done(function(a){if(e.storeTemplate){var o=$("<div />").attr("id",e.template).html(a);t.append(o)}n.resolve(a)}).fail(function(){n.reject()}),n},s=function(e,t,n,s,d){var c=$.Deferred(),u=c.promise(),f="",g={title:t||"",dialogClass:n||"",modal:!0,resizable:!1,buttons:s||[a.close],draggable:!1,closeOnEscape:!1,autoOpen:!1,template:d||"#modal_alert",storeTemplate:!1,closeX:!0,modalClose:!1},m=null,b=null;return e=e||{},e=$.extend({},g,e),e.buttons=r(e.buttons,c),i(e).done(function(t){f=$(Mustache.render(t,e)),e.validator&&f.find("form").attr("data-gx-widget","validator").find("input").attr({"data-validator-validate":e.validator.validate,"data-validator-regex":e.validator.regex||""}).addClass("validate"),f.dialog(e);try{m=f.dialog("instance")}catch(a){m=f.data("ui-dialog")}m.uiButtonSet.children().addClass("btn btn-default"),e.closeX===!1?m.uiDialogTitlebarClose.remove():m.uiDialogTitlebarClose.html("&times;").one("click",function(){o(m.element,c)}),e.modalClose&&$("body").find(".ui-widget-overlay").last().one("click",function(){o(m.element,c)}),b=m.element.find("form"),b.length&&b.on("submit",function(e){e.preventDefault()}),e.executeCode&&"function"==typeof e.executeCode&&e.executeCode.call($(m.element)),u.close=function(e){e?o(m.element,c):l(m.element,c)},f.dialog("open"),window.gx&&window.jse.widgets&&window.jse.widgets.init&&(window.jse.widgets.init(f),window.jse.controllers.init(f),window.jse.extensions.init(f))}).fail(function(){c.reject({error:"Template not found"})}),u},d=function(e){var t=$.extend({},{draggable:!0},e);return s(t,jse.core.lang.translate("hint","labels"),"",[a.ok])},c=function(e){var t=$.extend({},{draggable:!0},e);return s(t,jse.core.lang.translate("confirm","labels"),"confirm_dialog",[a.no,a.yes])},u=function(e){var t=$.extend({},{draggable:!0},e);return s(t,jse.core.lang.translate("prompt","labels"),"prompt_dialog",[a.abort,a.ok],"#modal_prompt")},f=function(e){var t=$.extend({},{draggable:!0},e);return s(t,jse.core.lang.translate("success","labels"),"success_dialog")},g=function(e){var t=$.extend({},{draggable:!0},e);return s(t,jse.core.lang.translate("error","labels"),"error_dialog")},m=function(e){var t=$.extend({},{draggable:!0},e);return s(t,jse.core.lang.translate("warning","labels"),"warn_dialog")},b=function(e){var t=$.extend({},{draggable:!0},e);return s(t,jse.core.lang.translate("info","labels"),"info_dialog")},p=function(e){$("body").append('<div class="modal-layer">'+e.content+"</div>"),e.modal=!0,e.dialogClass="gx-container",void 0===e.buttons&&(e.buttons=[{text:a.close.name,click:function(){$(this).dialog("close"),$(this).remove()}}]),$(".modal-layer:last").dialog(e)};e.error=g,e.warn=m,e.info=b,e.success=f,e.alert=d,e.prompt=u,e.confirm=c,e.custom=s,e.message=p}(jse.libs.modal);