gx.extensions.module("admin_search",["user_configuration_service","url_arguments"],function(e){"use strict";var r,t=$(this),i=$(e.button),a=$("ul.searchable:first"),s={searchIn:jse.core.lang.translate("admin_search_in_label","admin_labels"),orders:jse.core.lang.translate("admin_search_orders","admin_labels"),customers:jse.core.lang.translate("admin_search_customers","admin_labels"),categories:jse.core.lang.translate("admin_search_categories","admin_labels")},c={ESC:27,ARROW_UP:38,ARROW_DOWN:40,ENTER:13},n=jse.libs.user_configuration_service,o=jse.libs.url_arguments,l={userId:e.customer_id,configurationKey:"recentSearchArea"},g={},d=function(){switch(o.getCurrentFile()){case"orders.php":r="orders",a.trigger("select:item");break;case"customers.php":r="customers",a.trigger("select:item");break;case"categories.php":r="categories",a.trigger("select:item");break;default:n.get({data:l,onSuccess:function(e){e.success&&e.configurationValue?(r=e.configurationValue,a.trigger("select:item")):(r="categories",a.trigger("select:item"))},onError:function(){r="categories",a.trigger("select:item")}})}},h=function(){$(".search-item.active").length||console.error("No active list item!"),r=$(".search-item.active").data("searchArea"),t.trigger("refresh:search-area")},u=function(){t.on("click",function(){t.trigger("refresh:search-area"),a.trigger("show:dropdown"),t.trigger("focus")}),t.on("keyup",function(e){switch(e.which){case c.ENTER:t.trigger("perform:search");break;case c.ESC:return void a.trigger("hide:dropdown");case c.ARROW_UP:a.trigger("select:item:previous");break;case c.ARROW_DOWN:a.trigger("select:item:next")}a.trigger("refresh:search-item")}),t.on("perform:search",function(){var e,i=t.val(),a="_self";switch(r){case"customers":e=["customers.php","?search=",i].join("");break;case"categories":e=["categories.php","?search=",i].join("");break;case"orders":e=["orders.php","?oID=",i,"&action=edit"].join("")}n.set({data:$.extend(l,{configurationValue:r})}),window.open(e,a)}),t.on("refresh:search-area",function(){t.prop("placeholder",s[r])}),t.on("blur",function(){t.prop("placeholder",""),a.trigger("hide:dropdown")})},f=function(){i.on("click",function(){t.trigger("refresh:search-area"),t.val(""),a.trigger("show:dropdown"),t.trigger("focus")})},m=function(){a.on("select:item",function(){a.find("li[data-search-area="+r+"]").addClass("active")}),a.on("show:dropdown",function(){a.fadeIn(),a.trigger("select:item"),a.trigger("refresh:search-item")}),a.on("select:item:first",function(){var e=a.find("li.search-item.active"),r=a.find("li.search-item:first");e.removeClass("active"),r.addClass("active"),h(),a.trigger("select:item")}),a.on("select:item:last",function(){var e=a.find("li.search-item.active"),r=a.find("li.search-item:last");e.removeClass("active"),r.addClass("active"),h(),a.trigger("select:item")}),a.on("select:item:previous",function(){var e=a.find("li.search-item.active"),r=e.prev();r.length?(e.removeClass("active"),r.addClass("active"),h(),a.trigger("select:item")):a.trigger("select:item:last")}),a.on("select:item:next",function(){var e=a.find("li.search-item.active"),r=e.next();r.length?(e.removeClass("active"),r.addClass("active"),h(),a.trigger("select:item")):a.trigger("select:item:first")}),a.on("hide:dropdown",function(){a.fadeOut()}),a.on("click",function(e){e.stopPropagation(),a.find("li").removeClass("active");var r=$(e.target).is("span")?$(e.target).parents("li:first"):$(e.target);r.addClass("active"),h(),a.trigger("hide:dropdown"),t.trigger("perform:search")}),a.on("refresh:search-item",function(){$(".search-item").each(function(){$(this).find(".search-query-item").text(t.val());var e=[s.searchIn,s[$(this).data("searchArea")]].join(" ");$(this).find(".search-query-description").text(e)})})};return g.init=function(e){u(),m(),f(),d(),e()},g});