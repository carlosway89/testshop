/* SubmenuHandler.js <?php
#   --------------------------------------------------------------
#   SubmenuHandler.js 2014-11-20 gambio
#   Gambio GmbH
#   http://www.gambio.de
#   Copyright (c) 2014 Gambio GmbH
#   Released under the GNU General Public License (Version 2)
#   [http://www.gnu.org/licenses/gpl-2.0.html]
#   --------------------------------------------------------------
?>*/
/*<?php
if($GLOBALS['coo_debugger']->is_enabled('uncompressed_js') == false)
{
?>*/
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('9 Z(f,g){4(D)C.B(\'Z 2a\');3.1C=26;4(s(f)!=\'t\'){3.1C=3.S(f)}3.1x=1H;4(s(g)!=\'t\'){3.1x=3.S(g)}3.M=1m();3.1j=1H;n h=3,E=1m(),1i=0,15=0,1t=\'\',1b=y,1c=F;3.1n=9(){4(D)C.B(\'Z 1n\');3.1D();2s.1O=$.2k([],2j);3.1z();3.M=3.X(0,3.M);3.1P();$(\'.1f\').U(\'W\',h.14);$(\'.1f\').13(\'W\',9(){h.14(F)});$(\'.5 l 1k\').U(\'W\',h.1l);$(\'.5 l 1k\').13(\'W\',h.1l);$(\'.5 l\').U(\'1r\');$(\'.5 l\').13(\'1r\',9(){4(D)C.B(\'.5 l 1r\');$(3).I(\'a\').x(\'2e\',\'\');1c=y;1g(15);1t=$(3).x(\'m\');n a=3;4(1b==F){1i=1Q(9(){h.1p(a)},h.1C)}J{4(D)C.B(\'Z 2i 2r\');h.1p(a)}});$(\'.5 l\').U(\'12\');$(\'.5 l\').13(\'12\',9(){4(D)C.B(\'.5 l 12\');1g(1i);1t=\'\'});$(\'.5\').U(\'12\');$(\'.5\').13(\'12\',9(){4(D)C.B(\'.5 12\');1c=F;4(s(2g)==\'t\'){15=1Q(h.14,h.1x)}})};3.1p=9(a){4(s($(a).k(\'.5\').x(\'m\'))!=\'t\'){n b=0;4($(a).k(\'.5\').x(\'m\').P(\'r\')!=-1){b=$(a).k(\'.5\').x(\'m\').w(\'r\',\'\')}4(D)C.B(\'.5 l: 2w \'+b);4(b==0){$(\'.2z-1S.1T.5 G l a.A\').Y(\'A\')}J{$(\'#r\'+b+\' G l a.A\').Y(\'A\')}$(a).I(\'a\').N(\'A\');n c=0;4($(a).x(\'m\').P(\'p\')!=-1){c=$(a).x(\'m\').w(\'p\',\'\')}4(D)C.B(\'.5 l: 1N \'+c);h.1G(b,c)}};3.1G=9(b,c){17=3.S(b);1y=3.S(c);n d=3.18(17,3.M);4(d==y){1U.1V({1W:\'1X=1Y&m=\'+17+\'&1Z=\'+20,24:\'25.27\',28:"29",2b:F,2d:9(a){d=h.18(17,h.M);4(d==y){$(\'.1f:o\').2f(a);h.1D();h.M=h.X(17,h.M)}h.1E(1y);h.1z()}}).2h}J{h.1E(1y)}};3.1z=9(){$.1h(1O,9(i,e){4(2F(e)!==2m.2o.1N){4($(\'.1R\').O<=0){$(\'#p\'+e+\'\').N(\'1a\')}$(\'#1K\'+e+\'\').N(\'1a\');4($(\'#11\'+e+\'\').1J(\'G\').O>0){$(\'#11\'+e+\'\').N(\'1a\')}J{$(\'#11\'+e+\'\').k(\'l\').N(\'1a\')}}J{4($(\'.1R\').O<=0){$(\'#p\'+e+\'\').N(\'19\')}$(\'#1K\'+e+\'\').N(\'19\');4($(\'#11\'+e+\'\').1J(\'G\').O>0){$(\'#11\'+e+\'\').N(\'19\')}J{$(\'#11\'+e+\'\').k(\'l\').N(\'19\')}}})};3.1E=9(a){4(s(a)==\'t\'||a==0||10(a)){T y}3.1j++;n b=$(\'#p\'+a).1M().K,1d=$(\'#p\'+a).1M().L+21.22(\'p\'+a).23,1e=0;4(s($(\'.5[m^="r"]:o\').I(\'u:o\').8(\'1A-K-R\'))!=\'t\'){4(10($(\'.5[m^="r"]:o\').I(\'u:o\').8(\'1A-K-R\').w(\'v\',\'\'))){1e=0}J{1e=H($(\'.5[m^="r"]:o\').I(\'u:o\').8(\'1A-K-R\').w(\'v\',\'\'))}}b-=1e;n c=0;4(s($(\'.5[m^="r"]:o\').I(\'u:o\').8(\'q-K\'))!=\'t\'){4(10($(\'.5[m^="r"]:o\').I(\'u:o\').8(\'q-K\').w(\'v\',\'\'))){c=0}J{c=H($(\'.5[m^="r"]:o\').I(\'u:o\').8(\'q-K\').w(\'v\',\'\'))}}b-=c;n d=0;4(s($(\'#p\'+a).k(\'u\').8(\'q-K\'))!=\'t\'){d=H($(\'#p\'+a).k(\'u\').8(\'q-L\').w(\'v\',\'\'))}n e=0;4(s($(\'#p\'+a).k(\'u\').8(\'q-2c\'))!=\'t\'){e=H($(\'#p\'+a).k(\'u\').8(\'q-Q\').w(\'v\',\'\'))}1d+=d+e-2;4(3.1F(a)==y){1d+=7}$(\'#r\'+a).k(\'.j\').8({\'z-16\':3.1j,K:b,L:1d});3.1I();3.1q(a);1o(n i=0;i<E.O;i++){4(D)C.B(E[i])}3.1L(a)};3.1L=9(a){n b=3.S(a);$(\'#r\'+b).k(\'.j\').2l();E=3.X(\'r\'+b,E);$(\'.5\').1h(9(){4($(3).x(\'m\')!=\'\'&&h.18($(3).x(\'m\'),E)==y){$(3).k(\'.j\').1v();$(3).I(\'G l a.A\').Y(\'A\')}});1b=y;n c=0;4(s($(\'#p\'+b).k(\'.j\').8(\'z-16\'))!=\'t\'&&$(\'#p\'+b).k(\'.j\').8(\'z-16\')!=\'2n\'){c=H($(\'#p\'+b).k(\'.j\').8(\'z-16\'))}1o(n i=0;i<E.O;i++){4(c<($(\'#\'+E[i]).k(\'.j\').8(\'z-16\'))){$(\'#\'+E[i]+\' G l a.A\').Y(\'A\');1b=F}}};3.1q=9(a){n b=3.S(a);4($(\'#p\'+b).k(\'.5\').x(\'m\')!=\'\'){n c=$(\'#p\'+b).k(\'.5\').x(\'m\');4(s(c)!=\'t\'){E=3.X(c,E);1u=c.w(\'r\',\'\');4(1u!=\'0\'){3.1q(1u)}}}};3.1I=9(){E=1m()};3.18=9(a,b){n c=y;1o(n i=0;i<b.O;i++){4(b[i]==a){c=F;2p}}T c};3.X=9(a,b){4(3.18(a,b)==y){b.2q(a)}T b};3.S=9(a){1B=0;4(s(a)!=\'t\'||10(a)==y){1B=H(a)}T 1B};3.14=9(a){4(D)C.B(\'Z 14\');4(s(a)==\'t\'){a=y}4(a==F){4(1c==F){1g(15);$(\'.5[m^="r"]\').k(\'.j\').1v();$(\'.5 G l a.A\').Y(\'A\');$(\'.1f\').U(\'W\',3)}}J{1g(15);$(\'.5[m^="r"]\').k(\'.j\').1v();$(\'.5 G l a.A\').Y(\'A\')}};3.1F=9(a){n b=y,V=0;4(10(a)){V=a.w(/[^\\d]+/g,\'\');4(10(V)){4(D)C.B(\'Z 1F(): 2t 2u "\'+a+\'"\');T y}}J{V=a}4(s($(\'#p\'+V).k(\'.5\'))==\'2v\'&&$(\'#p\'+V).k(\'.5\').x(\'m\').P(\'r\')!=-1){b=F}T b};3.1P=9(){n a=\'\',1w=\'\';$(\'u[m^="r"]\').1h(9(){a=$(3).x(\'m\').w(\'r\',\'\');4($(\'#p\'+a).O>0){1w=$(\'#p\'+a).k(\'.5\').x(\'m\').w(\'r\',\'\');h.M=h.X(1w,h.M)}})};3.1l=9(){4(D)C.B(\'.5 l 1k W, 2x 2y: \'+$(3).k(\'l\').I(\'a:o\').x(\'1s\'));2A.1s=$(3).k(\'l\').I(\'a:o\').x(\'1s\');T F};3.1D=9(){4(2B.2C.2D(/2E [0-6]\\./)){n a=0;4(s($(\'.j .5\').8(\'q-L\'))!=\'t\'&&$(\'.j .5\').8(\'q-L\').P(\'v\')!=-1){a+=H($(\'.j .5\').8(\'q-L\').w(\'v\',\'\'))}4(s($(\'.j .5\').8(\'q-Q\'))!=\'t\'&&$(\'.j .5\').8(\'q-Q\').P(\'v\')!=-1){a+=H($(\'.j .5\').8(\'q-Q\').w(\'v\',\'\'))}4(s($(\'.j .5 u:o\').8(\'q-L\'))!=\'t\'&&$(\'.j .5 u:o\').8(\'q-L\').P(\'v\')!=-1){a+=H($(\'.j .5 u:o\').8(\'q-L\').w(\'v\',\'\'))}4(s($(\'.j .5 u:o\').8(\'q-Q\'))!=\'t\'&&$(\'.j .5 u:o\').8(\'q-Q\').P(\'v\')!=-1){a+=H($(\'.j .5 u:o\').8(\'q-Q\').w(\'v\',\'\'))}4(s($(\'.j .5 G l\').8(\'R\'))!=\'t\'&&$(\'.j .5 G l\').8(\'R\').P(\'v\')!=-1){n b=H($(\'.j .5 G l\').8(\'R\').w(\'v\',\'\'));b+=a;$(\'.j\').8(\'R\',b+\'v\')}}};3.1n()}',62,166,'|||this|if|submenu|||css|function||||||||||submenu_container|closest|li|id|var|first|menu_cat_id_|padding|submenu_box_id_|typeof|undefined|div|px|replace|attr|false||active|log|console|fb|v_visible_menu_ids_array|true|ul|Number|find|else|top|left|v_parent_ids_array|addClass|length|search|right|width|clear_number|return|die|c_parent_id|click|push_id|removeClass|SubmenuHandler|isNaN|megadropdown_top_link_id_|mouseleave|live|close_all|v_timeout_close|index|c_parents_id|in_array|current|parentOfCurrent|v_inactive_submenus_shown|v_allow_close_all|t_left|t_border_top_width|wrap_shop|clearTimeout|each|v_timeout_open|v_z_index|img|open_link|Array|init_binds|for|open_menu|set_visible_menu_ids|mouseenter|href|v_active_element|t_categories_id|hide|parent_id|v_delay_close|c_categories_id|setCurrentsClasses|border|c_number|v_delay_open|ie6_fix|load_submenu|is_submenu|get_submenus_by_categories_id|500|reset_visible_menu_ids|next|megadropdown_|show_submenu|offset|categories_id|parentsIdsBak|find_loaded_submenus|setTimeout|cat_go_up_button|box|categories|jQuery|ajax|data|module|Submenus|XTCsid|gm_session_id|document|getElementById|offsetWidth|url|request_port|250|php|type|GET|ready|async|bottom|success|title|prepend|gm_style_edit_mode_running|html|open_delay|parentsIds|extend|show|js_options|auto|global|break|push|ignored|window|wrong|parameter|object|parents_id|open|link|content|location|navigator|appVersion|match|MSIE|parseInt'.split('|'),0,{}));
/*<?php
}
else
{
?>*/
function SubmenuHandler(p_delay_open, p_delay_close)
{
    if(fb)console.log('SubmenuHandler ready');
    
	this.v_delay_open = 250; // unit: ms
	if(typeof(p_delay_open) != 'undefined')
	{
		this.v_delay_open = this.clear_number(p_delay_open);
	}

	this.v_delay_close = 500; // unit: ms
	if(typeof(p_delay_close) != 'undefined')
	{
		this.v_delay_close = this.clear_number(p_delay_close);
	}

	this.v_parent_ids_array = Array();
	this.v_z_index = 500;
	var coo_this = this;
	var v_visible_menu_ids_array = Array();
	var v_timeout_open = 0;
	var v_timeout_close = 0;
	var v_active_element = '';
	var v_inactive_submenus_shown = false;
	var v_allow_close_all = true;


	this.init_binds = function()
	{
		if(fb)console.log('SubmenuHandler init_binds');

		this.ie6_fix();
        window.parentsIdsBak = $.extend([], parentsIds);
        this.setCurrentsClasses();
        
		this.v_parent_ids_array = this.push_id(0, this.v_parent_ids_array);
		this.find_loaded_submenus();

		$('.wrap_shop').die('click', coo_this.close_all);
		$('.wrap_shop').live('click', function(){coo_this.close_all(true)});

		$('.submenu li img').die('click', coo_this.open_link);
		$('.submenu li img').live('click', coo_this.open_link);

		$('.submenu li').die('mouseenter');
		$('.submenu li').live('mouseenter', function()
		{
			if(fb)console.log('.submenu li mouseenter');

			// clear title obscuring the menu
			$(this).find('a').attr('title', '');

			v_allow_close_all = false;

			clearTimeout(v_timeout_close);

			v_active_element = $(this).attr('id');

			var t_coo_this = this;

			if(v_inactive_submenus_shown == true)
			{
				v_timeout_open = setTimeout(function(){
                    coo_this.open_menu(t_coo_this)
                }, coo_this.v_delay_open);
			}
			// ignore open_delay if there are no submenus that could be left accidentally
			else
			{
				if(fb)console.log('SubmenuHandler open_delay ignored')
				coo_this.open_menu(t_coo_this);
			}
		});

		$('.submenu li').die('mouseleave');
		$('.submenu li').live('mouseleave', function()
		{
			if(fb)console.log('.submenu li mouseleave');

			clearTimeout(v_timeout_open);
			v_active_element = '';
		});

		$('.submenu').die('mouseleave');
		$('.submenu').live('mouseleave', function()
		{
			if(fb)console.log('.submenu mouseleave');

			v_allow_close_all = true;

			if(typeof(gm_style_edit_mode_running) == 'undefined')
			{
				v_timeout_close = setTimeout(coo_this.close_all, coo_this.v_delay_close);
			}
        });
	}


	this.open_menu = function(p_coo_this)
	{
		if(typeof($(p_coo_this).closest('.submenu').attr('id')) != 'undefined')
		{
			var t_parents_id = 0;
			if($(p_coo_this).closest('.submenu').attr('id').search('submenu_box_id_') != -1)
			{
				t_parents_id = $(p_coo_this).closest('.submenu').attr('id').replace('submenu_box_id_', '');
			}
			if(fb)console.log('.submenu li: parents_id ' + t_parents_id);

			if(t_parents_id == 0)
			{
				$('.content-box.categories.submenu ul li a.active').removeClass('active');
			}
			else
			{
				$('#submenu_box_id_' + t_parents_id + ' ul li a.active').removeClass('active');

			}
			$(p_coo_this).find('a').addClass('active');

			var t_categories_id = 0;
			if($(p_coo_this).attr('id').search('menu_cat_id_') != -1)
			{
				t_categories_id = $(p_coo_this).attr('id').replace('menu_cat_id_', '');
			}
			if(fb)console.log('.submenu li: categories_id ' + t_categories_id);

			coo_this.get_submenus_by_categories_id(t_parents_id, t_categories_id);
		}
	}


	this.get_submenus_by_categories_id = function(p_parents_id, p_categories_id)
	{
		c_parents_id = this.clear_number(p_parents_id);
		c_categories_id = this.clear_number(p_categories_id);

		var t_already_loaded = this.in_array(c_parents_id, this.v_parent_ids_array);

		if(t_already_loaded == false)
		{
			jQuery.ajax(
			{
				data:		'module=Submenus&id=' + c_parents_id  + '&XTCsid=' + gm_session_id,
				url: 		'request_port.php',
				type: 		"GET",
				async:		true,
				success:	function(t_submenus_html)
				{
					t_already_loaded = coo_this.in_array(c_parents_id, coo_this.v_parent_ids_array);
					if(t_already_loaded == false)
					{
						$('.wrap_shop:first').prepend(t_submenus_html);
						coo_this.ie6_fix();
						coo_this.v_parent_ids_array = coo_this.push_id(c_parents_id, coo_this.v_parent_ids_array);
					}
					coo_this.load_submenu(c_categories_id);
                    coo_this.setCurrentsClasses();
				}
			}).html;
		}
		else
		{
			coo_this.load_submenu(c_categories_id);
		}

	}
    
    this.setCurrentsClasses = function()
    {
        $.each(parentsIdsBak, function(i, e){
            if(parseInt(e) !== js_options.global.categories_id)
            {
                if($('.cat_go_up_button').length <= 0)
                {
                    $('#menu_cat_id_' + e + '').addClass('parentOfCurrent');
                }
                $('#megadropdown_' + e + '').addClass('parentOfCurrent');
                if($('#megadropdown_top_link_id_' + e + '').next('ul').length > 0)
                {
                    $('#megadropdown_top_link_id_' + e + '').addClass('parentOfCurrent');
                }
                else
                {
                    $('#megadropdown_top_link_id_' + e + '').closest('li').addClass('parentOfCurrent');
                }
            }
            else
            {
                if($('.cat_go_up_button').length <= 0)
                {
                    $('#menu_cat_id_' + e + '').addClass('current');
                }
                $('#megadropdown_' + e + '').addClass('current');
                if($('#megadropdown_top_link_id_' + e + '').next('ul').length > 0)
                {
                    $('#megadropdown_top_link_id_' + e + '').addClass('current');
                }
                else
                {
                    $('#megadropdown_top_link_id_' + e + '').closest('li').addClass('current');
                }
            }
        });
    }


	this.load_submenu = function(p_categories_id)
	{
		if(typeof(p_categories_id) == 'undefined' || p_categories_id == 0 || isNaN(p_categories_id))
		{
			return false;
		}

		this.v_z_index++;

		var t_top = $('#menu_cat_id_' + p_categories_id).offset().top;
		var t_left = $('#menu_cat_id_' + p_categories_id).offset().left + document.getElementById('menu_cat_id_' + p_categories_id).offsetWidth;

		var t_border_top_width = 0;
		if(typeof($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('border-top-width')) != 'undefined')
		{
			if(isNaN($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('border-top-width').replace('px', '')))
			{
				t_border_top_width = 0;
			}
			else
			{
				t_border_top_width = Number($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('border-top-width').replace('px', ''));
			}

		}
		t_top -= t_border_top_width;

		var t_padding_top = 0;
		if(typeof($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('padding-top')) != 'undefined')
		{
			if(isNaN($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('padding-top').replace('px', '')))
			{
				t_padding_top = 0;
			}
			else
			{
				t_padding_top = Number($('.submenu[id^="submenu_box_id_"]:first').find('div:first').css('padding-top').replace('px', ''));
			}
		}
		t_top -= t_padding_top;

		var t_padding_left = 0;
		if(typeof($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-top')) != 'undefined')
		{
			t_padding_left = Number($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-left').replace('px', ''));
		}
		var t_padding_right = 0;
		if(typeof($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-bottom')) != 'undefined')
		{
			t_padding_right = Number($('#menu_cat_id_' + p_categories_id).closest('div').css('padding-right').replace('px', ''));
		}
		t_left += t_padding_left + t_padding_right - 2;

		if(this.is_submenu(p_categories_id) == false)
		{
			t_left += 7;
		}

		$('#submenu_box_id_' + p_categories_id).closest('.submenu_container').css(
		{
			'z-index': this.v_z_index,
			top: t_top,
			left: t_left
		});

		this.reset_visible_menu_ids();
		this.set_visible_menu_ids(p_categories_id);

		for(var i = 0; i < v_visible_menu_ids_array.length; i++)
		{
			if(fb)console.log(v_visible_menu_ids_array[i]);
		}

		this.show_submenu(p_categories_id);
	}


	this.show_submenu = function(p_categories_id)
	{
		var c_categories_id = this.clear_number(p_categories_id);

		$('#submenu_box_id_' + c_categories_id).closest('.submenu_container').show();
		v_visible_menu_ids_array = this.push_id('submenu_box_id_' + c_categories_id, v_visible_menu_ids_array);

		// hide menus not belonging to the last opened menu
		$('.submenu').each(function()
		{
			if($(this).attr('id') != '' && coo_this.in_array($(this).attr('id'), v_visible_menu_ids_array) == false)
			{
				$(this).closest('.submenu_container').hide();

				// reset styles
				$(this).find('ul li a.active').removeClass('active');
			}
		});

		// remove highlight-class (active) from submenus of current hovered menu entry
		v_inactive_submenus_shown = false;

		var current_z_index = 0;
		if(typeof($('#menu_cat_id_' + c_categories_id).closest('.submenu_container').css('z-index')) != 'undefined' && $('#menu_cat_id_' + c_categories_id).closest('.submenu_container').css('z-index') != 'auto')
		{
			current_z_index = Number($('#menu_cat_id_' + c_categories_id).closest('.submenu_container').css('z-index'));
		}

		for(var i = 0; i < v_visible_menu_ids_array.length; i++)
		{
			if(current_z_index < ($('#' + v_visible_menu_ids_array[i]).closest('.submenu_container').css('z-index')))
			{
				$('#' + v_visible_menu_ids_array[i] + ' ul li a.active').removeClass('active');
				v_inactive_submenus_shown = true;
			}
		}
	}


	this.set_visible_menu_ids = function(p_categories_id)
	{
		var c_categories_id = this.clear_number(p_categories_id);

		if($('#menu_cat_id_' + c_categories_id).closest('.submenu').attr('id') != '')
		{
			var t_submenu_box_id = $('#menu_cat_id_' + c_categories_id).closest('.submenu').attr('id');
			
			if(typeof(t_submenu_box_id) != 'undefined')
			{
				v_visible_menu_ids_array = this.push_id(t_submenu_box_id, v_visible_menu_ids_array);

				t_categories_id = t_submenu_box_id.replace('submenu_box_id_', '');

				if(t_categories_id != '0')
				{
					this.set_visible_menu_ids(t_categories_id);
				}
			}
		}
	}


	this.reset_visible_menu_ids = function()
	{
		v_visible_menu_ids_array = Array();
	}


	this.in_array = function(p_needle, p_haystack_array)
	{
		var t_found = false;
		for(var i = 0; i < p_haystack_array.length; i++)
		{
			if(p_haystack_array[i] == p_needle)
			{
				t_found = true;
				break;
			}
		}

		return t_found;
	}


	this.push_id = function(p_id, p_array)
	{
		if(this.in_array(p_id, p_array) == false)
		{
			p_array.push(p_id);
		}

		return p_array;
	}


	this.clear_number = function(p_number)
	{
		c_number = 0;

		if(typeof(p_number) != 'undefined' || isNaN(p_number) == false)
		{
			c_number = Number(p_number);
		}

		return c_number;
	}


	this.close_all = function(p_close_by_click)
	{
		if(fb)console.log('SubmenuHandler close_all');

		if(typeof(p_close_by_click) == 'undefined')
		{
			p_close_by_click = false;
		}

		if(p_close_by_click == true)
		{
			if(v_allow_close_all == true)
			{
				clearTimeout(v_timeout_close);

				$('.submenu[id^="submenu_box_id_"]').closest('.submenu_container').hide();
				$('.submenu ul li a.active').removeClass('active');
				$('.wrap_shop').die('click', this);
			}
		}
		else
		{
			clearTimeout(v_timeout_close);

			$('.submenu[id^="submenu_box_id_"]').closest('.submenu_container').hide();
			$('.submenu ul li a.active').removeClass('active');
		}
	}


	this.is_submenu = function(p_parent_id)
	{
		var t_is_submenu = false;
		var c_parent_id = 0;

		if(isNaN(p_parent_id))
		{
			c_parent_id = p_parent_id.replace(/[^\d]+/g, '');
			if(isNaN(c_parent_id))
			{
				if(fb)console.log('SubmenuHandler is_submenu(): wrong parameter "' + p_parent_id + '"');
				return false;
			}
		}
		else
		{
			c_parent_id = p_parent_id;
		}

		// check if it is a submenu
		if(typeof($('#menu_cat_id_' + c_parent_id).closest('.submenu')) == 'object'
			&& $('#menu_cat_id_' + c_parent_id).closest('.submenu').attr('id').search('submenu_box_id_') != -1)
		{
			t_is_submenu = true;
		}

		return t_is_submenu;
	}


	this.find_loaded_submenus = function()
	{
		var submenu_box_id = '';
		var parent_id = '';

		$('div[id^="submenu_box_id_"]').each(function()
		{
			submenu_box_id = $(this).attr('id').replace('submenu_box_id_', '');
			if($('#menu_cat_id_' + submenu_box_id).length > 0)
			{
				parent_id = $('#menu_cat_id_' + submenu_box_id).closest('.submenu').attr('id').replace('submenu_box_id_', '');
				coo_this.v_parent_ids_array = coo_this.push_id(parent_id, coo_this.v_parent_ids_array);
			}
		});
	}


	this.open_link = function()
	{
		if(fb)console.log('.submenu li img click, open link: ' + $(this).closest('li').find('a:first').attr('href'));
		location.href = $(this).closest('li').find('a:first').attr('href');

		return true;
	}


	// IE6 needs fixed width for outer div-block '.submenu_container' calculated by inner div-blocks paddings
	// ('.submenu', '.submenu div:first') and width of '.submenu ul li' (only set in IE6)
	this.ie6_fix = function()
	{
		if(navigator.appVersion.match(/MSIE [0-6]\./))
		{
			var t_paddings = 0;
			if(typeof($('.submenu_container .submenu').css('padding-left')) != 'undefined'
				&& $('.submenu_container .submenu').css('padding-left').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu').css('padding-left').replace('px', ''));
			}
			if(typeof($('.submenu_container .submenu').css('padding-right')) != 'undefined'
				&& $('.submenu_container .submenu').css('padding-right').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu').css('padding-right').replace('px', ''));
			}
			if(typeof($('.submenu_container .submenu div:first').css('padding-left')) != 'undefined'
				&& $('.submenu_container .submenu div:first').css('padding-left').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu div:first').css('padding-left').replace('px', ''));
			}
			if(typeof($('.submenu_container .submenu div:first').css('padding-right')) != 'undefined'
				&& $('.submenu_container .submenu div:first').css('padding-right').search('px') != -1)
			{
				t_paddings += Number($('.submenu_container .submenu div:first').css('padding-right').replace('px', ''));
			}

			if(typeof($('.submenu_container .submenu ul li').css('width')) != 'undefined'
				&& $('.submenu_container .submenu ul li').css('width').search('px') != -1)
			{
				var t_width = Number($('.submenu_container .submenu ul li').css('width').replace('px', ''));
				t_width += t_paddings;
				$('.submenu_container').css('width', t_width + 'px');
			}
		}
	}


	this.init_binds();
}
/*<?php
}
?>*/

