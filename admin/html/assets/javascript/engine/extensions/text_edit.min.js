gx.extensions.module("text_edit",["xhr","modal"],function(t){"use strict";var e=$(this),a={},i=$.extend(!0,{},a,t),n={},s=null,o=function(t,e){var a=t.find("textarea"),i=t.find("ul.actions li"),n=a.data("data");a.prop("disabled",!0),e&&a.val(n),i.hide().filter(".edit").show(),a.data("texteditEdited")?i.filter(".reset").show():i.filter(".reset").hide()},r=function(){var t=$(this),e=t.closest(".dataTableRow"),a=e.find("textarea"),i=e.find("ul.actions li"),n=a.val();a.data("data",n).val("").prop("disabled",!1).focus().val(n),t.hide().siblings().show(),a.data("texteditEdited")?i.filter(".reset").show():i.filter(".reset").hide()},d=function(){var t=$(this),e=t.closest(".dataTableRow"),a=e.find("textarea"),i=a.val(),n=a.data("data");i!==n?jse.libs.modal.confirm({content:jse.core.lang.translate("discard_changes_prompt","messages"),title:jse.core.lang.translate("abort","buttons"),position:{my:"center",at:"center",of:e}}).done(function(){o(e,!0)}):o(e)},l=function(){var t=$(this),e=t.closest(".dataTableRow"),a=e.find("textarea"),s=a.val(),r=a.data("data"),d=n._data(a);d.value=s,t.hasClass("pending")||(s!==r?(t.addClass("pending"),jse.libs.xhr.ajax({url:i.url,data:d}).done(function(t){a.data("texteditEdited",t.edited),e.find(".searchSection").attr("title",t.source),o(e)}).fail(function(){jse.libs.modal.error({content:"Error",title:"Error",position:{my:"center",at:"center",of:e}})}).always(function(){t.removeClass("pending")})):o(e))},c=function(){var e=$(this),a=e.closest(".dataTableRow"),s=a.find("textarea");t=n._data(e),e.hasClass("pending")||(e.addClass("pending"),jse.libs.xhr.ajax({url:i.url,data:t}).done(function(t){t.success&&(a.find(".searchSection").attr("title",t.source),s.val(t.value),s.data("texteditEdited",!1),o(a),e.hide())}).fail(function(){jse.libs.modal.error({content:"Error",title:"Error",position:{my:"center",at:"center",of:a}})}).always(function(){e.removeClass("pending")}))},f=function(){var t=($(this),n._data($(this)));s.trigger("submitform",[t]),window.scrollTo(0,0)};return n.init=function(t){s=$("#"+i.filter),e.on("click",".edit",r).on("click",".save",l).on("click",".abort",d).on("click",".reset",c),s.length&&e.on("click",".searchPhrase, .searchSection",f),$("#needle").focus(),t()},n});