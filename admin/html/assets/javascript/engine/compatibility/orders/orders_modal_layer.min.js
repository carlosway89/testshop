gx.compatibility.module("orders_modal_layer",["xhr"],function(e){"use strict";var t=$(this),a=($("#modal_layer_container"),$(".gx-orders-table tr:not(.dataTableHeadingRow) input")),n={detail_page:!1,comment:""},r=$.extend(!0,{},n,e),o={},c=function(e){var a=$("#delete_confirm_form");a.attr("action",a.attr("action")+"&oID="+t.data("order_id")),e.preventDefault(),a.dialog({title:jse.core.lang.translate("TEXT_INFO_HEADING_DELETE_ORDER","orders").replace("%s",t.data("order_id")),modal:!0,dialogClass:"gx-container",buttons:u(a),width:420})},i=function(e){var t=$("#delete_tracking_code_confirm_form"),a=o._data($(this));t.dialog({title:jse.core.lang.translate("TXT_PARCEL_TRACKING_DELETE_BUTTON","parcel_services").replace("%s",a.tracking_code),modal:!0,dialogClass:"gx-container",buttons:[{text:jse.core.lang.translate("close","buttons"),"class":"btn",click:function(){$(this).dialog("close")}},{text:jse.core.lang.translate("delete","buttons"),"class":"btn btn-primary",click:function(){$(this).dialog("close"),jse.libs.xhr.post({url:"request_port.php?module=ParcelServices&action=delete_tracking_code",data:{tracking_code_id:a.tracking_code_id,order_id:a.order_id,page_token:a.page_token}}).done(function(e){$("#tracking_code_wrapper > .frame-content > table").html(e.html)})}}],width:420})},l=function(e){var n=$("#multi_delete_confirm_form");return e.preventDefault(),0===a.filter(":checked").length?!1:(p(n),n.attr("action",n.attr("action")+"&oID="+t.data("order_id")),void n.dialog({title:jse.core.lang.translate("TEXT_INFO_HEADING_MULTI_DELETE_ORDER","orders").replace("%s",t.data("order_id")),modal:!0,dialogClass:"gx-container",buttons:u(n),width:420}))},s=function(e){var n=$("#multi_cancel_confirm_form");return e.preventDefault(),0===a.filter(":checked").length?!1:(p(n),n.attr("action",n.attr("action")+"?oID="+t.data("order_id")),void n.dialog({title:jse.core.lang.translate("TEXT_INFO_HEADING_MULTI_CANCEL_ORDER","orders").replace("%s",t.data("order_id")),modal:!0,dialogClass:"gx-container",buttons:u(n),width:420}))},d=function(e){var t=$("#update_orders_status_form");if(e.preventDefault(),r.detail_page)t.append('<input type="hidden" name="gm_multi_status[]" value="'+r.order_id+'" />'),t.find(".selected_orders").text(r.order_id),t.find('textarea[name="gm_comments"]').html(r.comment);else{if(0===a.filter(":checked").length)return!1;p(t)}t.dialog({title:jse.core.lang.translate("HEADING_GM_STATUS","orders"),modal:!0,dialogClass:"gx-container",buttons:u(t),width:580})},_=function(e){var a=$("#add_tracking_code_form");e.preventDefault(),a.dialog({title:jse.core.lang.translate("TXT_PARCEL_TRACKING_HEADING","parcel_services").replace("%s",t.data("order_id")),modal:!0,dialogClass:"gx-container",buttons:u(a),width:420})},u=function(e){var t=[{text:jse.core.lang.translate("close","buttons"),"class":"btn",click:function(){$(this).dialog("close")}}];switch(r.action){case"delete":case"multi_delete":t.push({text:jse.core.lang.translate("delete","buttons"),"class":"btn btn-primary",click:function(){e.submit()}});break;case"add_tracking_code":t.push({text:jse.core.lang.translate("add","buttons"),"class":"btn btn-success",click:function(e){g(e)}});break;case"update_orders_status":t.push({text:jse.core.lang.translate("execute","buttons"),"class":"btn btn-primary",click:function(t){e.submit()}});break;case"multi_cancel":t.push({text:jse.core.lang.translate("send","buttons"),"class":"btn btn-primary",click:function(t){e.submit()}})}return t},g=function(e){e.stopPropagation();var a=$("#parcel_service_tracking_code").val();return""===a?!1:($.ajax({type:"POST",url:"request_port.php?module=ParcelServices&action=add_tracking_code",timeout:3e4,dataType:"json",context:this,data:{tracking_code:a,service_id:$("#parcel_services_dropdown option:selected").val(),order_id:t.data("order_id"),page_token:$(".page_token").val()},success:function(){document.location.reload()}}),!1)},p=function(e){var t=[];a.filter(":checked").each(function(){e.append('<input type="hidden" name="gm_multi_status[]" value="'+$(this).val()+'" />'),t.push($(this).val())}),e.find(".selected_orders").text(t.join(", "))};return o.init=function(e){switch(r.action){case"delete":t.on("click",c);break;case"multi_delete":t.on("click",l);break;case"add_tracking_code":t.on("click",_);break;case"update_orders_status":t.on("click",d);break;case"multi_cancel":t.on("click",s)}"tracking_code_wrapper"===r.container&&t.on("click",".btn-delete",i),e()},o});