gx.extensions.module("table_inline_edit",["form","xhr"],function(t){"use strict";var e=$(this),a=null,i=null,d={multiEdit:!1},r=$.extend(!0,{},d,t),n={},o=function(t,a,i){var d=a.find("input, textarea, select, button, i"),r=d.filter(".editmode"),o=d.filter(".addmode"),l=d.filter(".defaultmode"),s=d.filter(":not(.editmode):not(.addmode):not(.defaultmode)");switch(r.hide(),o.hide(),l.hide(),a.find(".table_inlineedit_alt").remove(),t){case"edit":r.show(),s.prop("disabled",!1);break;case"add":o.show(),s.prop("disabled",!1);break;default:l.show(),s.prop("disabled",!0).each(function(){var t=$(this),e=n._data(t);if(t.attr("type")&&"checkbox"===t.attr("type").toLowerCase()&&e.alt){var a=e.alt.split("_"),i=t.prop("checked");t.after('<span class="table_inlineedit_alt">'+(i?a[0]:a[1])+"</span>")}else if("select"===t.prop("tagName").toLowerCase()){var d=function(){return r.hide(),t.children().length?(t.children('[value="'+t.val()+'"]').text(),void t.after('<span class="table_inlineedit_alt">'+t.children('[value="'+t.val()+'"]').text()+"</span>")):void setTimeout(function(){d()},200)};d()}})}e.trigger("FORM_UPDATE",[]),i&&a.removeClass("edit add default").addClass(t)},l=function(){var t=a.clone();t.find("[name]").each(function(){var t=$(this);t.attr("name",t.attr("name").replace("[]","[0]"))}),o("add",t,!0),jse.core.fallback.setupWidgetAttr(t),i.append(t),gx.widgets.init(i.find("tr").last()),gx.extensions.init(i.find("tr").last()),gx.controllers.init(i.find("tr").last()),gx.compatibility.init(i.find("tr").last())},s=function(){var t=$(this).closest("tr"),e=JSON.stringify(t.data("formcache")),a=JSON.stringify(jse.libs.form.getData(t,void 0,!0)),i=$.Deferred(),d=function(e){e&&($("#lightbox_package_"+e.data.id+"admin_button").off(),$("#lightbox_package_"+e.data.id),$.lightbox_plugin("close",e.data.id)),e&&e.data.reject?i.reject():(t.trigger("validator.reset",[]),jse.libs.form.prefillForm(t,t.data("formcache"),!0),o("default",t,!0),i.resolve())};if(e!==a){var r="lightbox_confirm.html?section=shop_offline&amp;message=dicard_changes_hint&amp;buttons=cancel-discard",n='<a href="'+r+'"></a>',l=$(n),s=l.lightbox_plugin({lightbox_width:"360px"});$("#lightbox_package_"+s).one("click",".discard",{reject:!1,id:s},d).one("click",".cancel",{reject:!0,id:s},d)}else d();return i.promise()},c=function(){var t=$(this).closest("tr"),a=e.find("tr.edit"),i=[];!r.multiEdit&&a.length&&a.each(function(){i.push(s.call($(this).find(".row_abort").first()))}),$.when.apply(void 0,i).promise().done(function(){t.data("formcache",jse.libs.form.getData(t,void 0,!0)),o("edit",t,!0)})},f=function(){var t=$(this),a=t.closest("tr"),i=jse.libs.form.getData(a,void 0,!0),d=t.data().url,r=$.Deferred();r.done(function(){d&&(jse.core.debug.info("Sending data:",i),jse.libs.xhr.ajax({url:d,data:i})),e.trigger("row_saved",[i]),o("default",a,!0)}),a.trigger("validator.validate",[{deferred:r}])},h=function(){var t=$(this),a=t.closest("tr"),i={id:a.data("id")},d=t.data().url,r=$('<a href="lightbox_confirm.html?section=shop_offline&amp;message=delete_job&amp;buttons=cancel-delete"></a>'),n=r.lightbox_plugin({lightbox_width:"360px"});$("#lightbox_package_"+n).one("click",".delete",function(){$.lightbox_plugin("close",n),d&&jse.libs.xhr.ajax({url:d,data:i}),e.trigger("row_deleted",[i]),a.remove()})},g=function(){var t=$(this),a=t.data().url,i=t.closest("tr"),d=jse.libs.form.getData(i,void 0,!0),r=$.Deferred();r.done(function(){var t=function(){e.trigger("row_added",[d]),o("default",i,!0),l()};a?(jse.core.debug.info("Sending data:",d),jse.libs.xhr.ajax({url:a,data:d}).done(function(e){var a=e.id,d=i.find("input:not(:button), textarea, select");d.each(function(){var t=$(this),e=t.attr("name").replace("[0]","["+a+"]");t.data().lightboxHref&&(t.data().lightboxHref=t.data().lightboxHref.replace("id=0","id="+a)),t.attr("name",e)}),i.find("[data-lightbox-href]").each(function(){var t=$(this).attr("data-lightbox-href").replace("id=0","id="+a);$(this).attr("data-lightbox-href",t).data().lightboxHref=t}),t()})):t()}),i.trigger("validator.validate",[{deferred:r}])},u=function(t){var a=e.filter($(t.target)).add(e.find($(t.target))).length;if(!a){var i=$(t.target).closest("tr"),d=i.hasClass("edit")?"edit":i.hasClass("add")?"add":"default";o(d,i,!0)}};return n.init=function(t){a=e.find("tfoot > tr"),i=e.children("tbody"),e.addClass("table_inlineedit"),o("default",i),l(),e.on("click",".row_edit",c).on("click",".row_delete",h).on("click",".row_save",f).on("click",".row_add",g).on("click",".row_abort",s).on("widget.initialized",u),t()},n});