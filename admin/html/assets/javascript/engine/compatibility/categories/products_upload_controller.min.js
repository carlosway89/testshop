gx.compatibility.module("products_upload_controller",[],function(i){"use strict";var t=$(this),a=t.find(".list:first"),n=t.find(".product-image-uploader"),e=$("#images-row-template"),d=i.hasMopics?i.lastId+1:0,r={},m=function(){d++;var i=$(Mustache.render(e.html(),{id:d,idPlusOne:d+1}));i.hide(),i.find("img.preview-image").css({opacity:.2}),a.append(i),i.on("change","input:file",function(){var t=i.find("img.preview-image"),a=i.find("label.file-name"),n=i.find('[name*="gm_prd_img_name"]'),e=this.files[0],d=new FileReader;if(d.onload=function(i){t.attr("src",i.target.result)},d.readAsDataURL(e),e.name.length>=40){var r=e.name.substring(0,37)+"...";a.text(r)}else a.text(e.name);var m=250;$.each(i.find(".hidden"),function(i,t){$(t).hide().removeClass("hidden").fadeIn(m),m+=250}),t.animate({opacity:1},500),n.val(e.name)}),i.fadeIn(),gx.widgets.init(i.find("[name*=gm_gmotion_product_image]").parent())},o=function(i){d--,a.find("[data-id="+i+"]").remove(),s()},s=function(){$.each(a.find("[data-id]"),function(t,a){i.hasMopics&&(t=i.lastId+t),$(a).attr("data-id",t),$(a).find('[for*="mo_pics_"]:first').attr("for","mo_pics_"+t),$(a).find("input:file").attr("id","mo_pics_"+t).attr("name","mo_pics_"+t),$(a).find('[name*="gm_prd_img_name_"]').attr("name","gm_prd_img_name_"+t),$.each($(a).find('[name*="gm_alt_id"]'),function(){var i=$(this).data("languageId"),a=["gm_alt_id[",t,"]","[",i,"]"].join("");$(this).attr("name",a)}),$.each($(a).find('[name*="gm_alt_text"]'),function(){var i=$(this).data("languageId"),a=["gm_alt_text[",t,"]","[",i,"]"].join("");$(this).attr("name",a)})})},f=function(i){if($(i.target).is(".delete-button")){var t=$(i.target).parents("[data-id]:first").data("id");o(t)}$(i.target).is(n)&&m()};return r.init=function(i){t.bind("click",f),i()},r});